# OPTIONAL: Explicit Cloudflare Tunnel Config
# This is a more explicit version that lists each external service individually
# instead of using a wildcard. Use this if you want to be extra cautious.
#
# To use this:
# 1. Rename this file to config.yaml
# 2. Update kustomization.yaml to use this file instead
#
# NOTE: The wildcard approach in the default config.yaml is equally secure
# because DNS records control what reaches the tunnel. This is just more explicit.

tunnel: threadripper
protocol: http2
credentials-file: /etc/cloudflared/credentials/credentials.json
metrics: 0.0.0.0:2000
no-autoupdate: true
loglevel: info # Reduced from debug for production
transport-loglevel: info

ingress:
  # Test endpoint
  - hostname: hello.jrb.nz
    service: hello_world

  # External services only (no internal services)
  - hostname: search.jrb.nz
    service: https://cilium-gateway-gateway-external.gateway.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
      originServerName: search.jrb.nz

  - hostname: proxitok.jrb.nz
    service: https://cilium-gateway-gateway-external.gateway.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
      originServerName: proxitok.jrb.nz

  - hostname: libreddit.jrb.nz
    service: https://cilium-gateway-gateway-external.gateway.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
      originServerName: libreddit.jrb.nz

  - hostname: karakeep.jrb.nz
    service: https://cilium-gateway-gateway-external.gateway.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
      originServerName: karakeep.jrb.nz

  - hostname: vert.jrb.nz
    service: https://cilium-gateway-gateway-external.gateway.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
      originServerName: vert.jrb.nz

  - hostname: it-tools.jrb.nz
    service: https://cilium-gateway-gateway-external.gateway.svc.cluster.local:443
    originRequest:
      noTLSVerify: true
      originServerName: it-tools.jrb.nz

  # Catch-all 404
  - service: http_status:404
